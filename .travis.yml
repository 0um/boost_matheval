dist: bionic
sudo: false

language: cpp

script:
  - mkdir build
  - cd build
  - cmake -DWITH_COVERAGE=ON -DWITH_CLANG_TIDY=ON ..
  - make -j 2
  - make -j 2 check
  - curl -s https://codecov.io/bash | bash -

matrix:
  include:
    - os: linux
      compiler: clang
      addons:
        apt:
          packages:
            - libboost-dev
            - libboost-test-dev
    - os: linux
      compiler: gcc
      addons:
        apt:
          packages:
            - libboost-dev
            - libboost-test-dev
    - os: osx
      install:
        - brew link --force readline
      compiler: clang
    - if: branch = master
      os: linux
      env: docs=yes
      addons:
        apt:
          packages:
            - doxygen
            - libboost-dev
            - libboost-test-dev
      script:
        - bash doc/publish_documentation.sh

  allow_failures:
    - env: docs=yes
